<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éå¹´æ¶çé‡‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #fff;
            overflow-x: hidden;
        }

        h1 {
            margin-top: 30px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(255, 200, 0, 0.5);
            background: linear-gradient(to right, #ffd700, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            margin: 10px 0 5px;
            font-size: 1.1em;
            opacity: 0.7;
        }

        .question-counter {
            margin: 10px 0;
            font-size: 1.3em;
            background: rgba(255,255,255,0.1);
            padding: 8px 25px;
            border-radius: 20px;
        }

        /* è½‰ç›¤å€åŸŸ */
        .wheel-container {
            position: relative;
            margin: 20px 0;
        }

        .wheel-pointer {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5em;
            z-index: 10;
            filter: drop-shadow(0 0 5px rgba(255,0,0,0.7));
        }

        canvas#wheel {
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(255, 200, 0, 0.4), 0 0 60px rgba(255, 100, 100, 0.2);
        }

        .spin-btn {
            margin: 15px 0;
            padding: 15px 50px;
            font-size: 1.4em;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: #fff;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 3px;
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
            transition: all 0.3s;
        }

        .spin-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 30px rgba(255, 107, 107, 0.6);
        }

        .spin-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* è·‘é¦¬ç‡ˆé¡Œç›®å€åŸŸ */
        .slot-area {
            display: none;
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            max-width: 650px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.15);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .category-badge {
            display: inline-block;
            padding: 8px 25px;
            border-radius: 20px;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .cat-math { background: linear-gradient(135deg, #ff6b6b, #ee5a24); }
        .cat-english { background: linear-gradient(135deg, #4ecdc4, #44bd9e); }
        .cat-chinese { background: linear-gradient(135deg, #a29bfe, #6c5ce7); }

        /* è·‘é¦¬ç‡ˆè¦–çª— */
        .slot-window {
            position: relative;
            height: 80px;
            overflow: hidden;
            margin: 20px 0;
            border-radius: 15px;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .slot-window::before,
        .slot-window::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 25px;
            z-index: 2;
            pointer-events: none;
        }

        .slot-window::before {
            top: 0;
            background: linear-gradient(to bottom, rgba(15,12,41,0.9), transparent);
        }

        .slot-window::after {
            bottom: 0;
            background: linear-gradient(to top, rgba(15,12,41,0.9), transparent);
        }

        .slot-track {
            position: absolute;
            width: 100%;
            transition: none;
        }

        .slot-item {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            padding: 10px 20px;
            color: #fff;
        }

        .slot-item.active {
            background: rgba(255, 215, 0, 0.15);
            border-top: 2px solid rgba(255, 215, 0, 0.5);
            border-bottom: 2px solid rgba(255, 215, 0, 0.5);
        }

        .stop-btn {
            padding: 14px 45px;
            font-size: 1.2em;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            letter-spacing: 2px;
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
            animation: glowPulse 1s infinite;
        }

        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4); }
            50% { box-shadow: 0 5px 30px rgba(255, 107, 107, 0.8); }
        }

        .stop-btn:hover {
            transform: scale(1.05);
        }

        /* æœ€çµ‚é¡Œç›®é¡¯ç¤º */
        .final-question {
            display: none;
            margin-top: 20px;
            padding: 25px;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            font-size: 1.5em;
            line-height: 1.8;
            animation: fadeIn 0.5s;
        }

        .next-btn {
            margin-top: 20px;
            padding: 14px 45px;
            font-size: 1.2em;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            letter-spacing: 2px;
            display: none;
        }

        .next-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(108, 92, 231, 0.5);
        }

        /* å…¨éƒ¨å‡ºå®Œç•«é¢ */
        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .overlay.show {
            display: flex;
        }

        .final-result {
            text-align: center;
            animation: fadeIn 0.5s;
        }

        .final-result h2 {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .final-result p {
            font-size: 1.5em;
            margin: 10px 0;
        }

        .restart-btn {
            margin-top: 25px;
            padding: 15px 50px;
            font-size: 1.3em;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: #fff;
            cursor: pointer;
            font-weight: bold;
        }

        .restart-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>

<h1>ğŸ§§ éå¹´æ¶çé‡‘</h1>
<p class="subtitle">è½‰å‹•è½‰ç›¤é¸ç§‘ç›®ï¼Œå†æŒ‰åœæ­¢é¸é¡Œç›®ï¼</p>

<div class="question-counter">
    ğŸ“ ç¬¬ <b id="qcount">1</b> é¡Œ / å…± <b id="qtotal">22</b> é¡Œ
</div>

<div class="wheel-container">
    <div class="wheel-pointer">ğŸ”»</div>
    <canvas id="wheel" width="320" height="320"></canvas>
</div>

<button class="spin-btn" id="spinBtn" onclick="spinWheel()">ğŸ° è½‰å‹•è½‰ç›¤ï¼</button>

<!-- è·‘é¦¬ç‡ˆé¸é¡Œå€ -->
<div class="slot-area" id="slotArea">
    <div class="category-badge" id="catBadge">æ•¸å­¸</div>
    <div class="slot-window">
        <div class="slot-track" id="slotTrack"></div>
    </div>
    <button class="stop-btn" id="stopBtn" onclick="stopSlot()">ğŸ›‘ åœï¼</button>
    <div class="final-question" id="finalQuestion"></div>
    <button class="next-btn" id="nextBtn" onclick="nextRound()">ä¸‹ä¸€é¡Œ âœ</button>
</div>

<div class="overlay" id="overlay">
    <div class="final-result">
        <h2>ğŸ‰</h2>
        <p>æ‰€æœ‰é¡Œç›®éƒ½å‡ºå®Œäº†ï¼</p>
        <p style="font-size:1.1em; opacity:0.8;">ä½ å€‘å¤ªå²å®³äº†ï¼</p>
        <button class="restart-btn" onclick="restartGame()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
    </div>
</div>

<script>
// ========== é¡Œåº«ï¼ˆä¾†è‡ª Word æª”ï¼‰ ==========
const questions = {
    math: [
        "éå¹´è“è“æ”¶åˆ°3600å…ƒç´…åŒ…ï¼Œå¥¹æƒ³è¦ä¸€å°5006å…ƒçš„è…³è¸è»Šï¼Œè«‹å•å¥¹é‚„è¦å­˜å¤šå°‘éŒ¢ï¼Ÿ",
        "è«‹å•1/2ã€3/4ã€1/3æ’å‡ºå¤§å°é †åºï¼Ÿ",
        "è«‹å•1å…¬æ–¤çš„çŸ³é ­è·Ÿ1å…¬æ–¤çš„æ£‰èŠ±èª°æ¯”è¼ƒé‡ï¼Ÿ",
        "è«‹å•åˆ’èˆ¹æ¸¡æ²³ï¼Œä¸€è‰˜èˆ¹å¯ä»¥å4å€‹äººï¼Œå¦‚æœæœ‰16å€‹äººï¼Œè¦åˆ’å¹¾è¶Ÿå¤§å®¶æ‰èƒ½é †åˆ©éæ²³ï¼Ÿ",
        "è“è“è·ŸåŒå­¸å»å°‹å¯¶ï¼Œç™¼ç¾å±±æ´è£¡æœ‰ä¸€æ’æ•¸å­—ä¼¼ä¹æœ‰ä¸€äº›è¦å¾‹ã€1ã€ 1ã€ 2ã€ 3ã€ 5ã€ 8ã€ï¼Ÿã€ä½†æœ€å¾Œä¸€å€‹å•è™Ÿæ•¸å­—çœ‹ä¸æ¸…æ¥šï¼Œè«‹å•å®ƒå¯èƒ½æ˜¯ä»€éº¼æ•¸å­—ï¼Ÿ",
        "è“è“è²·äº†6åŒ…é¤…ä¹¾ï¼Œ1åŒ…è£¡æœ‰6ç‰‡é¤…ä¹¾ï¼Œç­ä¸Šæœ‰9å€‹åŒå­¸ï¼Œè«‹å•ä¸€äººå¯ä»¥å‡åˆ†å¹¾ç‰‡ï¼Ÿ",
        "æ¸›æ³•ç®—å¼ï¼Œè¢«æ¸›æ•¸æ¸›å»8ï¼Œæ¸›æ•¸åŠ 10ï¼Œå¾—åˆ°çš„å·®ç‚º32ï¼Œè«‹å•åŸæœ¬çš„å·®ç‚ºå¤šå°‘ï¼Ÿ",
        "10 â€“ 2ï¼Š3ï¼ï¼Ÿ"
    ],
    english: [
        "è«‹èªªå‡º26å€‹å­—æ¯ç™¼éŸ³",
        "è«‹å¯«å‡ºç¾åœ¨æ™‚é˜æ™‚é–“è‹±æ–‡",
        "æ‹¿3å€‹éª°å­ï¼Œéª°å‡º3å€‹æ•¸å­—ä¸¦å¯«å‡ºä»–å€‘çš„è‹±æ–‡ï¼",
        "è«‹å¯«å‡ºã€é’è›™ã€è·Ÿã€æ¤…å­ã€çš„è‹±æ–‡å–®å­—",
        "è«‹ç”¨2å¥è‹±æ–‡å¥å­ï¼Œå½¢å®¹å¦³è‡ªå·±ï¼",
        "è«‹å¯«å‡ºæœ‰ã€ooã€çš„2å€‹å–®å­—ï¼Œä¾‹å¦‚ã€toolã€",
        "å‡ºåœ‹é‡åˆ°å¤–åœ‹äººï¼Œèªª2å¥è‹±æ–‡å¥å­ï¼"
    ],
    chinese: [
        "è«‹èªªå‡º5å€‹ã€4å­—æˆèªã€",
        "è«‹å¯«å‡º5å€‹å­—è£¡æœ‰ã€è™«ã€",
        "è«‹å¯«å‡º5å€‹å­—è£¡æœ‰ã€é–€ã€",
        "è«‹èªªå‡ºé€™5å€‹å­—éƒ¨é¦–ã€è€…ã€ã€ã€è‡£ã€ã€ã€å¹¸ã€ã€ã€è…¿ã€ã€ã€é¼“ã€",
        "è«‹å¯«å‡ºã€ã„’ã„§ã„¤Ë‹ã€ç‰‡ã€ç•«ã€ã„’ã„§ã„¤Ë‹ã€ã€å¤§ã€ã„’ã„§ã„¤Ë‹ã€",
        "è«‹å¯«å‡ºã€ã„ã„§Ë‹ã€å¾—ã€ã€ã„ã„§Ë‹ã€ç¯€ã€ã€ã„ã„§Ë‹ã€å¿µ",
        "è«‹è‡ªå·±æ¥é¾3å€‹è©èªï¼Œä¾‹å¦‚ã€æ–¹å‘ã€>ã€å‘å¿ƒåŠ›ã€>ã€åŠ›æ°£ã€"
    ]
};

const TOTAL_QUESTIONS = questions.math.length + questions.english.length + questions.chinese.length;

// ========== éŠæˆ²ç‹€æ…‹ ==========
let questionCount = 0;
let currentCategory = '';
let usedQuestions = { math: [], english: [], chinese: [] };
let isSpinning = false;
let slotRunning = false;
let slotAnimId = null;
let slotPool = [];
let slotPosition = 0;

document.getElementById('qtotal').textContent = TOTAL_QUESTIONS;

// ========== è½‰ç›¤ç¹ªè£½ ==========
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const segments = [
    { label: 'æ•¸å­¸', color: '#ff6b6b', cat: 'math' },
    { label: 'è‹±æ–‡', color: '#4ecdc4', cat: 'english' },
    { label: 'åœ‹èª', color: '#a29bfe', cat: 'chinese' },
];
let wheelAngle = 0;

function drawWheel(angle) {
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    const r = cx - 10;
    const segAngle = (2 * Math.PI) / segments.length;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    segments.forEach((seg, i) => {
        const startAngle = angle + i * segAngle;
        const endAngle = startAngle + segAngle;

        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, r, startAngle, endAngle);
        ctx.closePath();
        ctx.fillStyle = seg.color;
        ctx.fill();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(startAngle + segAngle / 2);
        ctx.textAlign = 'center';
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 22px Microsoft JhengHei, sans-serif';
        ctx.fillText(seg.label, r * 0.55, 8);
        ctx.restore();
    });

    ctx.beginPath();
    ctx.arc(cx, cy, 22, 0, 2 * Math.PI);
    ctx.fillStyle = '#fff';
    ctx.fill();
    ctx.beginPath();
    ctx.arc(cx, cy, 18, 0, 2 * Math.PI);
    ctx.fillStyle = '#24243e';
    ctx.fill();
}

drawWheel(0);

// ========== è½‰ç›¤æ—‹è½‰ ==========
function spinWheel() {
    if (isSpinning) return;

    const allDone = Object.keys(questions).every(cat =>
        usedQuestions[cat].length >= questions[cat].length
    );
    if (allDone) {
        document.getElementById('overlay').classList.add('show');
        return;
    }

    isSpinning = true;
    document.getElementById('spinBtn').disabled = true;
    document.getElementById('slotArea').style.display = 'none';

    const spinDuration = 3000 + Math.random() * 1000;
    const totalRotation = (5 + Math.random() * 5) * 2 * Math.PI;
    const startTime = performance.now();
    const startAngle = wheelAngle;

    function animate(now) {
        const elapsed = now - startTime;
        const progress = Math.min(elapsed / spinDuration, 1);
        const ease = 1 - Math.pow(1 - progress, 3);
        wheelAngle = startAngle + totalRotation * ease;
        drawWheel(wheelAngle);

        if (progress < 1) {
            requestAnimationFrame(animate);
        } else {
            isSpinning = false;
            const segAngle = (2 * Math.PI) / segments.length;
            const normalizedAngle = ((wheelAngle % (2 * Math.PI)) + 2 * Math.PI) % (2 * Math.PI);
            const pointerAngle = (3 * Math.PI / 2 - normalizedAngle + 2 * Math.PI) % (2 * Math.PI);
            let segIndex = Math.floor(pointerAngle / segAngle) % segments.length;

            let cat = segments[segIndex].cat;
            if (usedQuestions[cat].length >= questions[cat].length) {
                const available = Object.keys(questions).filter(c =>
                    usedQuestions[c].length < questions[c].length
                );
                if (available.length > 0) {
                    cat = available[Math.floor(Math.random() * available.length)];
                } else {
                    document.getElementById('overlay').classList.add('show');
                    return;
                }
            }

            currentCategory = cat;
            startSlot();
        }
    }

    requestAnimationFrame(animate);
}

// ========== è·‘é¦¬ç‡ˆ ==========
function startSlot() {
    const pool = questions[currentCategory];
    const available = pool.map((_, i) => i).filter(i => !usedQuestions[currentCategory].includes(i));

    if (available.length === 0) return;

    // å»ºç«‹è·‘é¦¬ç‡ˆçš„é¡Œç›®åˆ—è¡¨ï¼ˆç”¨å¯ç”¨çš„é¡Œç›®é‡è¤‡å¡«æ»¿ï¼‰
    slotPool = available;

    // æ›´æ–° UI
    const badge = document.getElementById('catBadge');
    const catNames = { math: 'æ•¸å­¸', english: 'è‹±æ–‡', chinese: 'åœ‹èª' };
    const catClasses = { math: 'cat-math', english: 'cat-english', chinese: 'cat-chinese' };
    badge.textContent = catNames[currentCategory];
    badge.className = 'category-badge ' + catClasses[currentCategory];

    // å»ºç«‹è·‘é¦¬ç‡ˆé …ç›®ï¼ˆé‡è¤‡å¤šæ¬¡è®“å®ƒçœ‹èµ·ä¾†åœ¨æ»¾å‹•ï¼‰
    const track = document.getElementById('slotTrack');
    track.innerHTML = '';
    const repeatCount = 50; // é‡è¤‡å¤šæ¬¡ç¢ºä¿å¤ é•·
    for (let r = 0; r < repeatCount; r++) {
        for (let i = 0; i < slotPool.length; i++) {
            const div = document.createElement('div');
            div.className = 'slot-item';
            div.textContent = pool[slotPool[i]];
            track.appendChild(div);
        }
    }

    // é¡¯ç¤ºè·‘é¦¬ç‡ˆï¼Œéš±è—çµæœ
    document.getElementById('finalQuestion').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'none';
    document.getElementById('stopBtn').style.display = 'inline-block';
    document.getElementById('slotArea').style.display = 'block';

    // é–‹å§‹æ»¾å‹•
    slotPosition = 0;
    slotRunning = true;
    const speed = 8; // æ¯å¹€ç§»å‹•çš„åƒç´ 

    function animateSlot() {
        if (!slotRunning) return;
        slotPosition += speed;
        track.style.transform = `translateY(-${slotPosition}px)`;
        slotAnimId = requestAnimationFrame(animateSlot);
    }

    slotAnimId = requestAnimationFrame(animateSlot);
}

function stopSlot() {
    if (!slotRunning) return;
    slotRunning = false;
    cancelAnimationFrame(slotAnimId);

    const track = document.getElementById('slotTrack');
    const itemHeight = 80;
    const totalItems = slotPool.length;

    // è¨ˆç®—ç›®å‰åœåœ¨å“ªä¸€å€‹é …ç›®
    const currentIdx = Math.floor(slotPosition / itemHeight) % totalItems;
    const selectedPoolIdx = slotPool[currentIdx];

    // åŠ å…¥ç·©åœå‹•ç•«ï¼šå†æ»¾å¹¾æ ¼å¾Œåœä¸‹
    const extraItems = 5 + Math.floor(Math.random() * 5);
    const targetPosition = (Math.floor(slotPosition / itemHeight) + extraItems) * itemHeight;
    const startPos = slotPosition;
    const distance = targetPosition - startPos;
    const duration = 1500;
    const startTime = performance.now();

    function easeStop(now) {
        const elapsed = now - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const ease = 1 - Math.pow(1 - progress, 3);
        const pos = startPos + distance * ease;
        track.style.transform = `translateY(-${pos}px)`;

        if (progress < 1) {
            requestAnimationFrame(easeStop);
        } else {
            // åœä¸‹ä¾†äº†ï¼Œæ±ºå®šæœ€çµ‚é¡Œç›®
            const finalIdx = Math.floor(targetPosition / itemHeight) % totalItems;
            const finalPoolIdx = slotPool[finalIdx];

            // æ¨™è¨˜å·²ä½¿ç”¨
            usedQuestions[currentCategory].push(finalPoolIdx);
            questionCount++;
            document.getElementById('qcount').textContent = questionCount;

            // é«˜äº®åœä¸‹çš„é …ç›®
            const items = track.querySelectorAll('.slot-item');
            const stopItemIndex = Math.floor(targetPosition / itemHeight);
            if (items[stopItemIndex]) {
                items[stopItemIndex].classList.add('active');
            }

            // é¡¯ç¤ºæœ€çµ‚é¡Œç›®
            const finalQ = document.getElementById('finalQuestion');
            finalQ.textContent = questions[currentCategory][finalPoolIdx];
            finalQ.style.display = 'block';

            // éš±è—åœæ­¢æŒ‰éˆ•ï¼Œé¡¯ç¤ºä¸‹ä¸€é¡Œ
            document.getElementById('stopBtn').style.display = 'none';

            const allDone = Object.keys(questions).every(cat =>
                usedQuestions[cat].length >= questions[cat].length
            );
            const nextBtn = document.getElementById('nextBtn');
            if (allDone) {
                nextBtn.textContent = 'ğŸ‰ çµæŸéŠæˆ²';
                nextBtn.onclick = () => document.getElementById('overlay').classList.add('show');
            } else {
                nextBtn.textContent = 'ä¸‹ä¸€é¡Œ âœ';
                nextBtn.onclick = nextRound;
            }
            nextBtn.style.display = 'inline-block';
        }
    }

    requestAnimationFrame(easeStop);
}

// ========== ä¸‹ä¸€é¡Œ ==========
function nextRound() {
    document.getElementById('slotArea').style.display = 'none';
    document.getElementById('spinBtn').disabled = false;
}

// ========== é‡æ–°é–‹å§‹ ==========
function restartGame() {
    questionCount = 0;
    usedQuestions = { math: [], english: [], chinese: [] };
    document.getElementById('qcount').textContent = '1';
    document.getElementById('overlay').classList.remove('show');
    document.getElementById('slotArea').style.display = 'none';
    document.getElementById('spinBtn').disabled = false;
    slotRunning = false;
    if (slotAnimId) cancelAnimationFrame(slotAnimId);
}
</script>

</body>
</html>
